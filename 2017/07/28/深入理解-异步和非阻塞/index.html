<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="Hexo, NexT"><meta name="description" content="异步和非阻塞的概念实际上已经出现了很长一段时间。但是异步真正开始流行起来，是因为AJAX技术逐渐成为主流的web开发技术。非阻塞的概念真正流行起来，是当java引入NIO,也可以称作非阻塞IO的API，开始走进主流的开发人员的视线，真正流行起来，也可以认为是node.js带来的。  同步 ，异步，阻塞，非阻塞这几个概念相互之间联系紧密，很难区分。很多程序员都不知道它们之间的具体的不同。本文就会详细"><meta property="og:type" content="article"><meta property="og:title" content="深入理解--异步和非阻塞"><meta property="og:url" content="https://liuchi.coding.me/2017/07/28/深入理解-异步和非阻塞/index.html"><meta property="og:site_name" content="Liu Chi&#39;s Personal Website"><meta property="og:description" content="异步和非阻塞的概念实际上已经出现了很长一段时间。但是异步真正开始流行起来，是因为AJAX技术逐渐成为主流的web开发技术。非阻塞的概念真正流行起来，是当java引入NIO,也可以称作非阻塞IO的API，开始走进主流的开发人员的视线，真正流行起来，也可以认为是node.js带来的。  同步 ，异步，阻塞，非阻塞这几个概念相互之间联系紧密，很难区分。很多程序员都不知道它们之间的具体的不同。本文就会详细"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2018-01-05T10:47:49.033Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="深入理解--异步和非阻塞"><meta name="twitter:description" content="异步和非阻塞的概念实际上已经出现了很长一段时间。但是异步真正开始流行起来，是因为AJAX技术逐渐成为主流的web开发技术。非阻塞的概念真正流行起来，是当java引入NIO,也可以称作非阻塞IO的API，开始走进主流的开发人员的视线，真正流行起来，也可以认为是node.js带来的。  同步 ，异步，阻塞，非阻塞这几个概念相互之间联系紧密，很难区分。很多程序员都不知道它们之间的具体的不同。本文就会详细"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://liuchi.coding.me/2017/07/28/深入理解-异步和非阻塞/"><title>深入理解--异步和非阻塞 | Liu Chi's Personal Website</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/chi2liu"><img style="position:absolute;top:0;left:0;border:0" src="https://camo.githubusercontent.com/567c3a48d796e2fc06ea80409cc9dd82bf714434/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png"></a><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Liu Chi's Personal Website</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">游客是你，风景是我，无法避免，让你经过</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-favorite"><a href="/favorite" rel="section"><i class="menu-item-icon fa fa-fw fa-child"></i><br> 最爱</a></li><li class="menu-item menu-item-books"><a href="/books/" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i><br> 读书</a></li><li class="menu-item menu-item-movies"><a href="/movies/" rel="section"><i class="menu-item-icon fa fa-fw fa-film"></i><br> 电影</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://liuchi.coding.me/2017/07/28/深入理解-异步和非阻塞/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Liu Chi"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Liu Chi's Personal Website"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">深入理解--异步和非阻塞</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-28T20:29:30+08:00">2017-07-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/操作系统/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a></span></span> <span id="/2017/07/28/深入理解-异步和非阻塞/" class="leancloud_visitors" data-flag-title="深入理解--异步和非阻塞"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度&#58;</span><span class="leancloud-visitors-count"></span></span> <span class="post-meta-divider">|</span><span class="page-pv"><i class="fa fa-file-o"></i><span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1,886</span></div></div></header><div class="post-body" itemprop="articleBody"><p>异步和非阻塞的概念实际上已经出现了很长一段时间。但是异步真正开始流行起来，是因为AJAX技术逐渐成为主流的web开发技术。非阻塞的概念真正流行起来，是当java引入NIO,也可以称作非阻塞IO的API，开始走进主流的开发人员的视线，真正流行起来，也可以认为是node.js带来的。</p><p> 同步 ，异步，阻塞，非阻塞这几个概念相互之间联系紧密，很难区分。很多程序员都不知道它们之间的具体的不同。本文就会详细讨论这个问题，希望能帮助读者更好的了解这几个概念<br><a id="more"></a></p><h1 id="同步和阻塞"><a href="#同步和阻塞" class="headerlink" title="同步和阻塞"></a>同步和阻塞</h1><p>首先，我们先开始介绍与异步和非阻塞对立的两个概念：同步和阻塞</p><p> 对于web开发者来说，理解同步的概念相对比较容易，因为HTTP协议就是一个同步的协议。web浏览器向服务器发送一个请求并且等待它的响应。收到响应之后，浏览器才可以继续向服务器发送下一个请求，并且等待响应，周而复始的重复这个过程。在发送下一个请求之前必须等待响应的到达才行，这就成为了HTTP协议的一个巨大的性能瓶颈，当然为了解决这个问题，后来就出现了异步的AJAX技术。</p><p>阻塞的概念相对也是比较容易理解的。我们通过Java中的InputStream类的read方法来介绍阻塞的概念，文档中是这样描述read方法的：</p><blockquote><p>If no byte is available because the end of the stream has been reached, the value -1 is returned. This method blocks until input data is available, the end of the stream is detected, or an exception is thrown.<br>意思就是，如果已经到了流的末尾没有可读取的数据，那么就会返回-1。这个方法会一直阻塞，直到有可读取的数据，或者已经读到了流的末尾，或者抛出一个异常。</p></blockquote><p>这个方法的调用会一直阻塞，因为他会一直等待直到输入的数据可以用来读取。这通常会造成性能的瓶颈，因为这个方法会阻塞，导致无法继续执行随后的操作。</p><h1 id="异步和非阻塞"><a href="#异步和非阻塞" class="headerlink" title="异步和非阻塞"></a>异步和非阻塞</h1><p>异步和非阻塞就是同步和阻塞的相反面。在直觉上，可能会感觉这两个概念会有一些类似，因为他们都可以允许你们的线程在等待结果或者返回的时候不需要挂起整个线程。但是他们又有不同，因为异步调用通常需要包括一个回调机制或者事件机制，去主动通知调用方此时响应的结果已经可用了。而非阻塞调用往往会先返回一个任意的结果，然后调用者会不定时的反复去尝试获取返回的结果，直到结果已经可用了。这里的区别就是一个主动通知和被动去询问。举个例子，你去音乐店买周杰伦的专辑，但老板告诉你，现在没货，你就回去了，等到货到了，准备好了，老板会主动打电话通知你，专辑已经到啦，快来买吧，这就是异步机制，是主动通知的。而非阻塞则是，老板不会主动通知你，而是你自己隔个一两天就去这家店主动问问，专辑到了么，直到有一次你询问的时候，终于发现专辑到了。非阻塞的概念常常用于I/O中，而异步的概念则相对应用的比较广泛。</p><blockquote><p>特别的，异步I/O，意味着I/O操作是独立于当前的那个线程的操作而进行的。可以理解为，另外新开启了一个线程去执行I/O操作，当I/O操作完成之后会主动直接将结果返回。这里说的更详细一点就是，我们知道底层数据准备好之后，还要从内核区域拷贝到线程的缓冲区，非阻塞操作在这种意义上来说，又是同步的，因为非阻塞不会将这个拷贝数据的过程完成，而是当数据准备好了，告诉线程，你可以执行系统调用，将内核区域的数据拷贝到线程的缓冲区了，当然这个过程是同步，而且由于是系统调用，所以这个拷贝的过程也是阻塞的。而异步操作则不是，系统会开启一个线程当数据准备好了，这个线程还会完成这个从内核区将数据拷贝到线程缓冲区的过程，当数据拷贝完成了，才通知调用者，这时候调用者就直接可以用了。</p></blockquote><p>我们在看一个更详细的异步I/O的例子：</p><blockquote><p>我们假设同步I/O意味着发出一个I/O命令，然后一直等待，直到I/O操作完成。也就是说，你发出一个read命令，然后这个线程接下来的执行操作会一直等待，直到已经读到了内容。异步I/O则是你发出一个I/O命令，然后这个I/O不会立即完成。你可以先去执行接下来的程序。异步会实现一个接口，允许IO操作不阻塞当前的线程，而且当操作完成之后，会主动通知你操作已经完成。</p></blockquote><p>Non-blocking 在这里有一个很好的解释： <a href="http://stackoverflow.com/a/9489547/34956" target="_blank" rel="noopener">this StackOverflow answer</a>:</p><blockquote><p>This term is mostly used with IO. What this means is that when you make a system call, it will return immediately with whatever result it has without putting your thread to sleep (with high probability). For example non-blocking read/write calls return with whatever they can do and expect caller to execute the call again. try_lock for example is non-blocking call. It will lock only if lock can be acquired. Usual semantics for systems calls is blocking. read will wait until it has some data and put calling thread to sleep.<br>非阻塞I/O意味着当你发起一个系统调用的时候，他会立即返回一个结果，而不是将你的线程睡眠。非阻塞的读写操作，会收到一个立即的返回值，然后请求者会反复去重试，不断的去尝试，直到可以开始读写操作了。类似于忙等的状态，不断的测试，但是线程没有被阻塞。try_lock就是一个非阻塞的调用，他会尝试去获取锁，直到锁可以获取。通常来说，系统调用会进入内核，一般都是阻塞的，所以read操作往往是阻塞的，会等待可用数据，并且将线程休眠。</p></blockquote><p>现在，我们应该对于异步和非阻塞的概念已经有所了解了。下面我们就举个现实中的例子来加强理解：</p><blockquote><p>例如，传统的sockets API中，一个非阻塞的socket，通常会立即返回一个”would block” 的错误信息，然后需要调用独立的函数select or poll 去轮询检查什么时候可以再次尝试去读取。<br>但是异步的sockets （windows的sockets支持异步操作），.Net框架中也有异步I/O模型。你调用一个方法开始某个操作，然后 框架会在这个操作完成的时候，回调通知你，操作完成了。</p></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-heart"></i>感谢您的阅读-------------</div><div style="text-align:center;color:#ccc;font-size:14px">-------------如果有任何疑问,欢迎和我进行交流<i class="fa fa-envelope-square"></i> <em>cliu_whu@yeah.net</em>-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechat.jpg" alt="Liu Chi 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="Liu Chi 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/07/22/设计模式之代理模式（Proxy模式）/" rel="next" title="设计模式之代理模式（Proxy模式）"><i class="fa fa-chevron-left"></i> 设计模式之代理模式（Proxy模式）</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2017/07/31/细谈Select-Poll-Epoll/" rel="prev" title="细谈Select,Poll,Epoll">细谈Select,Poll,Epoll<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Liu Chi"><p class="site-author-name" itemprop="name">Liu Chi</p><p class="site-description motion-element" itemprop="description">如果记忆是一个罐头，我希望它永远不会过期</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">53</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">11</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">16</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/chi2liu" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://www.jianshu.com/u/f8e9b1c246f1" target="_blank" title="简书"><i class="fa fa-fw fa-heartbeat"></i> 简书</a></span><span class="links-of-author-item"><a href="http://music.163.com/#/user/event?id=16889672" target="_blank" title="网易云音乐"><i class="fa fa-fw fa-pinterest-square"></i> 网易云音乐</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/desperate-chi" target="_blank" title="知乎"><i class="fa fa-fw fa-globe"></i> 知乎</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 推荐链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://www.programcreek.com/" title="ProgramCreek" target="_blank">ProgramCreek</a></li><li class="links-of-blogroll-item"> <a href="http://tutorials.jenkov.com/" title="Jenkov" target="_blank">Jenkov</a></li><li class="links-of-blogroll-item"> <a href="https://www.ibm.com/developerworks/learn/" title="IBM" target="_blank">IBM</a></li><li class="links-of-blogroll-item"> <a href="https://tech.meituan.com/" title="美团技术点评团队" target="_blank">美团技术点评团队</a></li><li class="links-of-blogroll-item"> <a href="http://www.ruanyifeng.com/home.html" title="阮一峰的个人网站" target="_blank">阮一峰的个人网站</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#同步和阻塞"><span class="nav-number">1.</span><span class="nav-text"><a href="#&#x540C;&#x6B65;&#x548C;&#x963B;&#x585E;" class="headerlink" title="&#x540C;&#x6B65;&#x548C;&#x963B;&#x585E;"></a> &#x540C;&#x6B65;&#x548C;&#x963B;&#x585E;</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#异步和非阻塞"><span class="nav-number">2.</span><span class="nav-text"><a href="#&#x5F02;&#x6B65;&#x548C;&#x975E;&#x963B;&#x585E;" class="headerlink" title="&#x5F02;&#x6B65;&#x548C;&#x975E;&#x963B;&#x585E;"></a> &#x5F02;&#x6B65;&#x548C;&#x975E;&#x963B;&#x585E;</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Liu Chi</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">109.3k</span></div><div class="powered-by">个人专属</div> <span class="post-meta-divider">|</span><div class="theme-info">Personal's Page &mdash;</div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">Liu Chi</span></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 你好，你是第<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>位访客</span><span class="site-pv"><i class="fa fa-eye"></i> 本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){var r=!1,s=0,a=0,i=n.title.trim(),c=i.toLowerCase(),l=n.content.trim().replace(/<[^>]+>/g,""),h=l.toLowerCase(),p=decodeURIComponent(n.url),u=[],f=[];if(""!=i&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}u=u.concat(e(t,c,!1)),f=f.concat(e(t,h,!1))}),(u.length>0||f.length>0)&&(r=!0,s=u.length+f.length)),r){[u,f].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});function d(e,o,n,r){for(var s=r[r.length-1],i=s.position,c=s.word,l=[],h=0;i+c.length<=n&&0!=r.length;){c===t&&h++,l.push({position:i,length:c.length});var p=i+c.length;for(r.pop();0!=r.length&&(s=r[r.length-1],i=s.position,c=s.word,p>i);)r.pop()}return a+=h,{hits:l,start:o,end:n,searchTextCount:h}}var g=[];0!=u.length&&g.push(d(0,0,i.length,u));for(var v=[];0!=f.length;){var $=f[f.length-1],C=$.position,m=$.word,x=C-20,w=C+80;x<0&&(x=0),w<C+m.length&&(w=C+m.length),w>l.length&&(w=l.length),v.push(d(0,x,w,f))}v.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var y=parseInt("1");y>=0&&(v=v.slice(0,y));function T(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var b="";0!=g.length?b+="<li><a href='"+p+"' class='search-result-title'>"+T(i,g[0])+"</a>":b+="<li><a href='"+p+"' class='search-result-title'>"+i+"</a>",v.forEach(function(t){b+="<a href='"+p+'\'><p class="search-result">'+T(l,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:a,hitCount:s,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("ecunawYagLKgSyb8oSNBBhAQ-gzGzoHsz","7NodSbYvwhKYwjgDaFFH4gA3")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=s.get("url"),l=s.get("time"),c=document.getElementById(r);$(c).find(t).text(l)}for(i=0;i<n.length;i++){r=n[i],c=document.getElementById(r);var u=$(c).find(t);""==u.text()&&u.text(0)}}else o.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var s=new e,r=new AV.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!0),s.setACL(r),s.set("title",o),s.set("url",n),s.set("time",1),s.save(null,{success:function(e){$(document.getElementById(n)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/love.js"></script></body></html>